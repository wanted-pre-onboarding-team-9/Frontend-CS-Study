# url로 접속했을 때 어떤 플로우로 화면에 웹사이트가 그려지는지 네트워크 관점에서 설명해주세요.

1. **웹 브라우저에 URL을 입력**
   - 브라우저가 URL을 해독해서 원격지에서 조회할 웹 서버와 파일명, 포트번호(기본적으로 80)을 판단하고 HTTP 메시지 포맷에 맞게 GET 리퀘스트 메시지를 작성
2. **도메인명으로 IP 주소 조회**
   - DNS를 통해 도메인을 이용하여 웹사이트를 호스팅하는 서버의 IP주소를 알아냄
3. **브라우저가 OS의 프로토콜 스택에 메시지 송신을 의뢰하고 소켓을 작성**
   - DNS조회로 IP 주소를 알아내면 지정된 포트 번호는 서버측 컴퓨터의 프로세스를 특정하기 때문에 서버측 컴퓨터의 어떤 소켓과 접속할지를 지정할 수 있음
   - 통신 종단점의 두 소켓은 파이프로 읽기 쓰기 동작을 거듭하며 데이터를 주고받음
   - TCP 프로토콜은 Three-Way Handshake를 통해 SYN과 ACK 비트를 주고받으면서 각 단말이 통신이 가능한 상태인지 확인. HTTPS를 사용하는 경우 주고 받는 데이터의 암호화를 위한 TLS (Transport Layer Security) Handshake라는 추가 과정을 수행함
4. **TCP 프로토콜 스택에서 패킷을 만들고 TCP 헤더를 붙임**
   - Handshake를 통해 접속이 성립되었으면 서버로 보내야 하는 데이터(HTTP 메시지)를 TCP로 보낼 수 있는 최대치(MSS)에 맞춰 데이터를 알맞게 자르고 자른 데이터들마다 TCP 헤더를 붙여 몇번째 데이터인지 등등 제어 정보(TCP 헤더)를 덧붙임
   - TCP 헤더 주요정보: 송수신처의 포트 번호, 데이터 오프셋(데이터의 시작지점), ACK 번호, 6비트짜리 컨트롤 비트(URG, ACK, FIN, SYN, PSH, RST)
5. **IP 프로토콜 스택은 패킷을 더 잘게 나누고 원격지의 MAC 주소를 기반으로 한 MAC 헤더를 붙임**
   - TCP에서 만든 패킷의 기본적인 단위들을 회선과 네트워크 상황에 맞게 MTU를 기반으로 더 잘게 나누고 더 잘게 나눠진 패킷들에 IP 헤더를 붙임
   - ARP(Address Resolution Protocol)을 이용해 IP 주소를 기반으로 MAC주소를 알아냄
   - IP 헤더 주요 정보: 수신처 IP 주소, 4계층 프로토콜 종류, 송신처 IP 주소, 플래그(패킷이 조각으로 나뉜 것인지, 조각으로 나누는 것이 가능한지), 프래그먼트 오프셋(이 패킷의 데이터 부분이 메시지의 맨 앞부분부터 몇번째 바이트인지 나타냄)
6. **LAN 어댑터를 통해 바이너리 데이터를 전기신호로 바꿈**
   - 송신측에서 패킷 읽을 타이밍을 잡을 때 쓰는 프리앰블 비트, 패킷의 개시 위치가 어디서부터인지를 알게 해주는 비트, 패킷 오류 검출을 위한 FCS 비트 등 데이터를 추가하여 이진 데이터를 전기신호로 바꿈
7. **원격지의 MAC 주소로 전기 신호를 송출**
   - 전기 신호를 LAN 케이블을 통해 송출
   - 패킷의 목적지가 외부 네트워크이면 네트워크의 라우터에 패킷이 도달
   - 엑세스 회선, 인터넷 접속용 라우터를 통과하여 인터넷의 내부로 중개
8. **웹 서버로 전기 신호가 도착**
   - decapsulation 과정 수행
     - 전기 신호를 바탕으로 네트워크 계층을 올라가면서 조각난 패킷과 헤더 정보를 바탕으로 클라이언트에서 발송한 데이터를 재조립
   - 전기신호를 받은 웹 서버의 LAN 어댑터가 전기 신호를 이진 데이터로 바꿈
   - 네트워크 인터페이스에서 수신된 패킷의 MAC 주소를 비교하고 FCS로 패킷 훼손이 없는지 판단하여 올바른 패킷일 경우 운영체제단의 프로토콜 스택으로 올려보냄
   - 프로토콜 스택의 IP 담당 부분에서는 IP 헤더를 바탕으로 잘려서 온 패킷을 다시 리어셈블링하고 IP주소가 제대로 된게 맞는지 판단한 후 문제가 없으면 TCP 담당 부분으로 전달
   - TCP 담당 부분은 TCP헤더를 토대로 데이터가 잘려있는 패킷들을 다시 완성된 데이터로 만들고 해당 패킷을 잘 받았다면 클라이언트에 수신 확인 응답용 ACK 번호를 반송
   - 완성된 데이터를 만들었으면 제어 정보와 포트 번호를 토대로 TCP Handshake를 할 때 만들어놓은 적합한 소켓을 찾고 완성된 데이터를 소켓에 기록해 애플리케이션의 프로세스에 줌
9. **웹 서버가 요청을 처리하고 응답을 전송**
   - 웹 서버는 받은 요청 정보를 통해 경로에 위치한 콘텐츠를 클라이언트에게 응답
   - 응답에는 다음이 포함됨
     - 클라이언트에게 요청 상태를 알려주는 상태 코드
     - 브라우저에 응답 처리 방법을 알려주는 응답 헤더 (text/html, application/json 등)
     - 해당 경로에서 요청된 리소스 (이미지 파일과 같은 콘텐츠 또는 데이터, HTML, CSS, JS)
   - 서버 응답도 클라이언트 요청처럼 프로토콜 스택을 다시 내려가며 패킷 처리를 하고 인터넷과 라우터들을 거쳐 다시 응답 메시지를 클라이언트에게 반송
10. **웹 브라우저가 전송받은 콘텐츠를 렌더링**
11. **요청이 종료되었다면 4-Way-Handshake를 통해 접속을 끊고 소켓을 말소**

## **References**

[https://aws.amazon.com/ko/blogs/korea/what-happens-when-you-type-a-url-into-your-browser/](https://aws.amazon.com/ko/blogs/korea/what-happens-when-you-type-a-url-into-your-browser/) <br />

[https://maxkim-j.github.io/posts/packet-travel/](https://maxkim-j.github.io/posts/packet-travel/)
