# 웹페이지 렌더링 순서

<img src="https://velog.velcdn.com/images/zaman17/post/7281bb76-19be-4307-b6b9-4e849b3123a9/image.png"
width="500" height="200"/><br/>

1. HTML 파서가 문서를 파싱해서 DOM tree를 만들고, CSS 파서가 CSSOM tree를 생성합니다. <br/>
   <img src="https://velog.velcdn.com/images/zaman17/post/c676ccc7-e216-43c4-94a6-b31f6e2d128f/image.png" width="500" height="300"> <br/>
2. DOM tree와 CSSOM tree를 합쳐서 렌더링에 필요한 노드만 선택해 Render tree를 생성하여 페이지를 렌더링 하는데 사용합니다.
3. Layout 단계에서는 Render Tree를 화면에 어떻게 배치해야 할 것인지 노드의 정확한 위치와 크기를 계산하며,루트부터 노드를 순회하면서 노드의 정확한 크기와 위치를 계산하고 Render Tree에 반영합니다.
4. Paint 단계에서는 Layout 단계에서 계산된 값을 이용해 Render Tree의 각 노드를 화면상의 실제 픽셀로 변환합니다. 이때 픽셀로 변환된 결과는 하나의 레이어가 아니라 여러 개의 레이어로 관리됩니다.
5. 페인트 단계에서 생성된 레이어를 합성하여 실제 화면에 나타냅니다.

## 렌더링이란?

서버로부터 HTML, CSS, JavaScript 등 작성한 파일을 받아 브라우저에 뿌려주는 것을 의미합니다.

## 파싱이란?

브라우저가 코드를 이해하고 사용할 수 있는 구조로 변환하는 것을 의미합니다. 파싱 결과는 보통 문서 구조를 나타내는 노드 트리인데 파싱 트리 또는 문법 트리라고 부릅니다.

## 브라우저의 기본 구조

1. 사용자 인터페이스 - 주소 표시줄, 이전/다음 버튼, 북마크 메뉴 등 요청한 페이지를 보여주는 창을 제외한 나머지 모든 부분입니다.
2. 브라우저 엔진 - 사용자 인터페이스와 렌더링 엔진 사이의 동작을 제어합니다.
3. 렌더링 엔진 - 요청한 콘텐츠를 표시, 예를 들어 HTML을 요청하면 HTML과 CSS를 파싱하여 화면에 표시합니다.
4. 통신 - HTTP 요청과 같은 네트워크 호출에 사용됩니다. 이것은 플랫폼 독립적인 인터페이스이고 각 플랫폼 하부에서 실행됩니다.
5. UI 백엔드 - 콤보 박스와 창 같은 기본적인 장치를 그립니다. 플랫폼에서 명시하지 않은 일반적인 인터페이스로서, OS 사용자 인터페이스 체계를 사용합니다.
6. 자바스크립트 해석기 - 자바스크립트 코드를 해석하고 실행합니다.
7. 자료 저장소 - 이 부분은 자료를 저장하는 계층입니다. 쿠키를 저장하는 것과 같이 모든 종류의 자원을 하드 디스크에 저장할 필요가 있습니다. HTML5 명세에는 브라우저가 지원하는 '웹 데이터 베이스'가 정의되어 있습니다.(ex. localStorage나 Cookie와 같이 보조 기억장치에 데이터를 저장)

 <img src="https://d2.naver.com/content/images/2015/06/helloworld-59361-1.png" width="500" height="300"/>

크롬은 대부분의 브라우저와 달리 각 탭마다 별도의 렌더링 엔진 인스턴스를 유지하는 것이 주목할만하며, 각 탭은 독립된 프로세스로 처리됩니다.

## 렌더링 엔진

브라우저마다 다른 렌더링 엔진을 사용합니다. 파이어폭스는 Gecko, 사파리는 Webkit, 크롬은 Blink를 사용하는데 크롬도 기존에는 Webkit을 사용하다가 2013년 Blink로 갈라져 나왔습니다. 모든 엔진들은 웹표준을 준수하지만, 엔진마다 조금씩 다르게 작동합니다.

## 추가 질문

Q1. 레이아웃과 페인트 과정의 차이?

A1. 레이아웃(Layout)은 브라우저에서 요소들의 크기, 위치, 간격 등을 계산하여 문서의 구조를 결정하는 단계입니다. 이 단계에서는 HTML 요소와 CSS 스타일 규칙을 기반으로하여 각 요소가 어디에 위치하고 얼마나 차지하는지를 결정합니다. 이 과정에서 브라우저는 문서의 요소들을 계산하여 화면에 표시할 최종 레이아웃을 생성합니다.
페인트(Paint)는 레이아웃 단계에서 계산된 요소들을 실제로 화면에 그리는 단계입니다. 이 단계에서는 각 요소의 배경색, 텍스트 스타일, 테두리 등의 시각적 속성을 적용하여 실제로 화면에 렌더링됩니다. 브라우저는 이 단계에서 요소들을 픽셀 단위로 그려 화면에 보여줍니다.
요약하면, **레이아웃은** 요소들의 크기와 위치를 결정하고 **문서의 구조를 만들어내는 단계**이며, **페인트는** 요소들의 시각적 속성을 적용하여 **실제로 화면에 그리는 단계**입니다. 이 두 단계는 웹페이지의 렌더링 과정에서 차례대로 진행되어 사용자가 최종적으로 웹페이지를 볼 수 있게 됩니다.

## 추가 피드백

### UI가 업데이트 되는 경우

1. Layout 부터 다시 업데이트 하는 경우 <br/>
   <img src="https://velog.velcdn.com/images/cksrb63/post/e68de285-5166-479c-8e19-c79c6a08538f/image.png" width="500" height="50"/> <br/>
   요소의 위치나 크기가 변경되는 경우에 발생합니다. 또한 브라우저 창의 크기가 변할 때 주로 발생합니다.
2. Paint 부터 다시 업데이트 하는 경우 <br/>
   <img src="https://velog.velcdn.com/images/cksrb63/post/befda346-b8c6-4251-b5d2-86ec2b55f681/image.png" width="500" height="50"/> <br/>
   이미지나 텍스트의 색상같이 레이아웃이 변경되지 않는 스타일이 변경될 때 발생합니다.
3. Composite 부터 다시 업데이트 하는 경우 <br/>
   <img src="https://velog.velcdn.com/images/cksrb63/post/3c4b0e45-638a-42b7-bc13-983dd62840bf/image.png" width="500" height="50"/> <br/>
   레이어의 합성만 필요할 때 발생하며, 2개의 과정을 하지 않기 때문에 성능적으로 가장 우수합니다.

## 참고

https://velog.io/@zaman17/%EA%B8%B0%EC%88%A0%EB%A9%B4%EC%A0%91%EB%8C%80%EB%B9%84-%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EB%A0%8C%EB%8D%94%EB%A7%81-%EC%88%9C%EC%84%9C%EC%99%80-%EC%9B%90%EB%A6%AC
https://tecoble.techcourse.co.kr/post/2021-10-24-browser-rendering/
https://d2.naver.com/helloworld/59361
https://velog.io/@cksrb63/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EB%A0%8C%EB%8D%94%EB%A7%81%EA%B3%BC-%EC%B5%9C%EC%A0%81%ED%99%94
